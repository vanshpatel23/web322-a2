
const fs = require("fs").promises;
const path = require("path");

let projects = [];
let sectors = [];

function readJSON(relPath) {
  const full = path.join(__dirname, "..", relPath); // works on Vercel + local
  return fs.readFile(full, "utf8").then(JSON.parse);
}

module.exports = {
  initialize() {
   
    return Promise.all([
      readJSON("data/projectData.json"),
      readJSON("data/sectorData.json")
    ])
      .then(([proj, sect]) => {
        projects = Array.isArray(proj) ? proj : [];
        sectors = Array.isArray(sect) ? sect : [];
        if (!projects.length) throw "No project data loaded";
        return;
      });
  },

  getAllProjects() {
    return Promise.resolve(projects);
  },

  getProjectsBySector(sector) {
    const list = projects.filter(p => (p.sector || "").toLowerCase() === String(sector).toLowerCase());
    return list.length ? Promise.resolve(list) : Promise.reject(`No projects found for sector: ${sector}`);
  },

  getProjectById(id) {
    const key = String(id).trim();
    // allow numeric id or string id depending on your data
    const found =
      projects.find(p => String(p.id) === key) ||
      projects.find(p => String(p["id"]) === key);
    return found ? Promise.resolve(found) : Promise.reject("No project found for that id");
  },

  // optional helper if you need sectors elsewhere
  getSectors() {
    return Promise.resolve(sectors);
  }
};
